import{bV as d,aL as a,u as e,G as r}from"./chunks/framework.C8THFwVE.js";const m=JSON.parse('{"title":"DB数据类型一致性风险治理方案","description":"","frontmatter":{"date":"2022-11-08T13:47:56.000Z","title":"DB数据类型一致性风险治理方案","permalink":"/tech/c05570","categories":["代码宇宙","数据库"]},"headers":[],"relativePath":"04.代码宇宙/40.数据库/01.DB数据类型一致性风险治理方案.md","filePath":"04.代码宇宙/40.数据库/01.DB数据类型一致性风险治理方案.md"}'),l={name:"04.代码宇宙/40.数据库/01.DB数据类型一致性风险治理方案.md"};function n(i,t,o,b,g,c){return a(),e("div",null,[...t[0]||(t[0]=[r('<h1 id="一、背景" tabindex="-1">一、背景 <a class="header-anchor" href="#一、背景" aria-label="Permalink to &quot;一、背景&quot;">​</a></h1><p>生产环境中常见的数值溢出问题通常是这三类：</p><ol><li>数据库自增ID超过对应数据类型最大值</li><li>数据库中数值字段类型与Java代码中类型对应不一致，通常表现为Java中大类型对应DB中的小类型，比如Java中的Long类型字段在DB中对应的字段类型却是int</li><li>Java程序中的类型转换溢出，通常也是大值转小值，如比long转int；long转string，string再转int等</li></ol><p>而此次只针对前两种情况进行讨论</p><h1 id="二、目标" tabindex="-1">二、目标 <a class="header-anchor" href="#二、目标" aria-label="Permalink to &quot;二、目标&quot;">​</a></h1><p>旨在建立一套完善的数值溢出管理方案，在设计阶段提前预防此类风险。</p><ul><li>存量代码：将小类型改为大类型做兼容，有灰度的治理上线</li><li>增量代码：设计阶段避免此类风险</li></ul><h1 id="三、改进方案" tabindex="-1">三、改进方案 <a class="header-anchor" href="#三、改进方案" aria-label="Permalink to &quot;三、改进方案&quot;">​</a></h1><h2 id="db表字段、代码字段类型映射关系" tabindex="-1">DB表字段、代码字段类型映射关系 <a class="header-anchor" href="#db表字段、代码字段类型映射关系" aria-label="Permalink to &quot;DB表字段、代码字段类型映射关系&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Java TYPE</th><th>XML-JavaType</th><th>XML-JdbcType</th><th>DB Type</th></tr></thead><tbody><tr><td>Long</td><td>java.lang.Long</td><td>BIGINT</td><td>bigint</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>BINARY</td><td>binary</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>BINARY</td><td>geometry</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>BINARY</td><td>tinyblob</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>BIT</td><td>bit</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>LONGVARBINARY</td><td>blob</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>LONGVARBINARY</td><td>longblob</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>LONGVARBINARY</td><td>mediumblob</td></tr><tr><td>byte[]</td><td>_byte[]</td><td>VARBINARY</td><td>varbinary</td></tr><tr><td>Boolean</td><td>java.long.Boolean</td><td>BIT</td><td>bit</td></tr><tr><td>Boolean</td><td>java.long.Boolean</td><td>BIT</td><td>tinyint</td></tr><tr><td>Blob</td><td>java.sql.Blob</td><td>BLOB</td><td>blob*</td></tr><tr><td>String</td><td>java.lang.String</td><td>CHAR</td><td>char</td></tr><tr><td>String</td><td>java.lang.String</td><td>CHAR</td><td>enum</td></tr><tr><td>String</td><td>java.lang.String</td><td>CHAR</td><td>set</td></tr><tr><td>String</td><td>java.lang.String</td><td>VARCHAR</td><td>tinytext</td></tr><tr><td>String</td><td>java.lang.String</td><td>VARCHAR</td><td>varchar</td></tr><tr><td>String</td><td>java.lang.String</td><td>LONGVARCHAR</td><td>longtext</td></tr><tr><td>String</td><td>java.lang.String</td><td>LONGVARCHAR</td><td>mediumtext</td></tr><tr><td>String</td><td>java.lang.String</td><td>LONGVARCHAR</td><td>text</td></tr><tr><td>Date</td><td>java.util.Date</td><td>DATE</td><td>date</td></tr><tr><td>Date</td><td>java.util.Date</td><td>DATE</td><td>year</td></tr><tr><td>Date</td><td>java.util.Date</td><td>TIME</td><td>time</td></tr><tr><td>Date</td><td>java.util.Date</td><td>TIMESTAMP</td><td>datetime</td></tr><tr><td>Date</td><td>java.util.Date</td><td>TIMESTAMP</td><td>timestamp</td></tr><tr><td>LocalDate</td><td>java.time.LocalDate</td><td>DATE</td><td>date*</td></tr><tr><td>LocalDateTime</td><td>java.time.LocalDateTime</td><td>TIMESTRMP</td><td>datetime*</td></tr><tr><td>LocalDateTime</td><td>java.time.LocalDateTime</td><td>TIMESTRMP</td><td>timestamp*</td></tr><tr><td>BigDecimal</td><td>java.math.BigDecimal</td><td>DECIMAL</td><td>decimal*</td></tr><tr><td>Double</td><td>java.lang.Double</td><td>DOUBLE</td><td>double</td></tr><tr><td>Float</td><td>java.lang.Float</td><td>REAL</td><td>float</td></tr><tr><td>Float</td><td>java.lang.Double</td><td>FLOAT</td><td>float</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>geometrycollection</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>linestring</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>multilinestring</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>multipoint</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>multipolygon</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>point</td></tr><tr><td>Object</td><td>java.lang.Object</td><td>OTHER</td><td>polygon</td></tr><tr><td>Integer</td><td>java.lang.Integer</td><td>INTEGER</td><td>int</td></tr><tr><td>Integer</td><td>java.lang.Integer</td><td>INTEGER</td><td>mediumint</td></tr><tr><td>short</td><td>java.lang.Short</td><td>SMALLINT</td><td>smallint</td></tr><tr><td>Byte</td><td>java.lang.Byte</td><td>TINYINT</td><td>tinyint</td></tr></tbody></table><blockquote><p>另：DB中的int类型不能配置unsigned，不然会放大int类型的取值范围</p></blockquote><p>todo：如何自动化检测项目代码中不规范的映射？</p>',12)])])}const v=d(l,[["render",n]]);export{m as __pageData,v as default};
