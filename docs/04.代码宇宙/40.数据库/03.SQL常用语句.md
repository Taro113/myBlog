---
date: 2022-05-12 14:58:57
title: SQL常用语句
permalink: /tech/d10041
categories:
  - 代码宇宙
  - 数据库
---

### 1. 注释

   单行注释：`-- `   (注：`--`要与注释内容**以空格隔开**才会生效)
   多行注释：`/* */`

### 2. 创建数据库表及添加约束

   ```sql
   create table t_student{
   sno int(12) primary key auto_increment,                    -- 主键且自增
   sname varchar(6) not null,                                 -- 不为空
   sex char(1) default '男' check(sex = '男' || sex = '女'),   -- 性别默认为男，附带检查
   age int(3) check (age >=18 and age <=55),                   -- 检查age
   classname varchar(10),
   email varchar(18) unique                                   -- 不唯一
    -- constraint pk_stu primary key (sno),主键约束的另一种方式
    -- constraint ck_stu_sex check (sex = '男' || sex = '女'),检查的另一种方式
    -- constraint uq_stu_email unique (email)  不唯一的另一种方式
   };
   ```

   >  以上是在创建表时添加的约束，下面是创建表后再添加约束
   >
   >  ```sql
   >  alter table t_student add constraint pk_stu primary key (sno);  -- 添加主键约束
   >  alter table t_student modify sno(12) auto_increment;            -- 修改为自增
   >  alter table t_student add constraint ck_stu_sex check (sex = '男' || sex = '女')
   >  alter table t_student add constraint uq_stu_email unique (email)
   >  ```

- 撤销约束：`alter table user drop unique email`

### 3. 添加外键约束

创建表时添加：`contraint fk_cli_fg foreign key (flag) references Users (name)`
创建表后添加：`alter table client add contraint fk_cli_fg foreign key (flag) references Users (name)`

### 4. 删除表格
   `drop table t_student;`

   > 清空表：`truncate table t_student;`

### 5.  单条数据插入
`insert into user(name, pwd) values ('admin', 123)`

### 6. 批量数据插入

   ```sql
   insert into user(name, pwd) values
   ('user1', 111),
   ('user2', 222),
   ('user3', 333);
   ```

**注：**此语句也可添加单条数据，如下：

   > ```sql
   > insert into t_testuser values(2018001,'李红');
   > insert into t_testuser values(2018002,'张明');
   > insert into t_testuser values(2018003,'张三');
   > insert into t_testuser values(2018004,'李四');
   > insert into t_testuser values(2018005,'王五');
   > ```

### 7. 查询、更新、删除

   ```sql
   select * from user where id = 1;
   update user set age=age+1 where id = 4;
   delete from user where id = 1;
   ```

   模糊查询（尽量少用，性能很差）

   ```sql
   select * from user where id like '11%';        		-- %表示0个或多个字符
   select * from user where id like '_11';        		-- _表示一个字符
   select * from user where id like '[a-z][0-9]';      -- []类似正则表达式
   ```

### 8. 范围查询

   ```sql
   select * from user where age (not) BETWEEN 18 and 20;           （排除）从18到20之间
   select * from user where age in (18, 19, 23, 58);               只查找18,19,23,58岁的
   select * from user where age not in (15, 16, 17);               只要不是15,16,17岁的都可
   ```

### 9.  排序order by
降序排列：`desc`    升序排列：`asc`
`select * from user order by age (desc/asc);`

### 10. 去重
`select distinct(age) from table;`

> 它俩等价：`select distinct age from table;` 

### 11. 限制

```sql
select * from user limit 10;         -- 只查询前10条数据
select * from user limit 30, 10;
/% start:30, step:10  表示从第30条数据开始查询接下来的10条数据 %/
```

### 12. 分组group by

```sql
select name, sex, max(age) from user where age > 18 group by name, sex;
-- 对分组后的数据进行过滤：having
select name, sex, max(age) from user where age > 18 group by name, sex having age > 55;
```

### 13. 表结构列的增删

```sql
/* 删除列 */
ALTER TABLE 表名 DROP COLUMN 列名
-- 示例：
ALTER TABLE test DROP COLUMN test3

/* 增加列 */
ALTER TABLE 表明 ADD 列名 列类型
-- 示例：
ALTER TABLE test ADD CREATE_DATE datetime
```

### 14. `case when then else end`用法

> 两种格式：

1. 简单`case`函数

```sql
case sex
when '1' then '男'
when '2' then '女'
else '其他' end
```

2. `case`搜索函数

```sql
case when sex='1' then '男'
when sex='2' then '女'
else '其他' end
```

### 15. 只复制表结构

```sql
CREATE TABLE "NEW_TABLE" AS SELECT * FROM "OLD_TABLE" WHERE 1=2
```

### 20. SQL语句执行顺序：
`from` -> `where` -> `group by` -> `having` -> `select` -> `order by`

### 21. 常用关键字

- `distinct` : `select distinct username from user` : 返回唯一不同的值

- `in` : `select * from user where username in ('root', 'admin')` : 在where子句中规定多个值

- `inner join on` : `select * from user inner join order on user.id = order.user_id;` 

  - > 内连接，匹配到就返回

- `left join on` :  : 左连接，从左表那里返回所有的行

- `right join on` :  : 右连接，从右表那里返回所有的行

- `full join on` :  : 全连接，不管是否匹配到，全数据返回

- `union` / `union all` : `select name from user union (all) select name from account` 

  - > 合并结果集到同一列，区别是行数据相同是否合并


- `select into`: `select * into user_backup from user` : 查询拷贝，一般用于备份

- `(unique) index` : `create (unique) index id_cer_index on user(id_cer)` : 创建（唯一）索引

- `alter index` : `alter table user drop index id_cer_index` : 删除索引

- 表结构的增删改：

  - ```sql
    alter table user add id_cer int;					-- 新增列
    alter table user drop column id_cer;				-- 删除列
    alter table user alter column id_cer varchar;		-- 修改字段数据类型
    ```

  - 

- `is (not) null` : `select * from user where birth is null` : 判断字段是否为null

- `having子句` :  : WHERE关键字无法与合计函数一起使用，而HAVING可以


  - ```sql
    select name,SUM(price) from orders
    group by name
    having SUM(price)<2000
    ```






### 22. 函数

- `AVG(arg1)` : `select avg(price) as averagePrice from orders` : 计算平均值，不包括null值
- `COUNT(arg1)` : `select count(name) from user`: 返回数据总行数
- `FIRST(arg1)` : `select first(*) from user (order by name)` : 返回第一个记录的数据行
- `LAST(arg1)` :  : 返回最后一个记录的数据行
- `MAX/MIN(arg1)` : `select name, max(age) from user`:返回一列中的最大/小值
- `SUM(arg1)` : `select sum(price) from user` : 返回数据列所有值相加的总和
- `UCASE/LCASE(arg1)` : `select ucase(name) from user` : 将字段的值转换为大写/小写
- `MID(column, start, length)` : `select mid(name, 1, 2) from user` : 用于从文本字段中提取字符
- `LEN(arg1)` :  : 返回文本字段中值的长度
- `ROUND(column,num)` : `select round(price,2) from order` : 用于把数值字段舍入为指定的小数位数

- `NOW()` :`select now() from user` : 显示当前日期时间
- `FORMAT(column,format)`:`select format(birth,'YYYY-MM-DD') from user`:对字段进行格式化显示











