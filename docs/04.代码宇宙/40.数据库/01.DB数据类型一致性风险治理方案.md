---
date: 2026-02-16 13:47:56
title: DB数据类型一致性风险治理方案
permalink: /tech/c05570
categories:
  - 代码宇宙
  - 数据库
---



# 一、背景

生产环境中常见的数值溢出问题通常是这三类：

1. 数据库自增ID超过对应数据类型最大值
2. 数据库中数值字段类型与Java代码中类型对应不一致，通常表现为Java中大类型对应DB中的小类型，比如Java中的Long类型字段在DB中对应的字段类型却是int
3. Java程序中的类型转换溢出，通常也是大值转小值，如比long转int；long转string，string再转int等

而此次只针对前两种情况进行讨论

# 二、目标

旨在建立一套完善的数值溢出管理方案，在设计阶段提前预防此类风险。

- 存量代码：将小类型改为大类型做兼容，有灰度的治理上线
- 增量代码：设计阶段避免此类风险

# 三、改进方案

## DB表字段、代码字段类型映射关系

| Java TYPE     | XML-JavaType            | XML-JdbcType  | DB Type            |
| ------------- | ----------------------- | ------------- | ------------------ |
| Long          | java.lang.Long          | BIGINT        | bigint             |
| byte[]        | _byte[]                 | BINARY        | binary             |
| byte[]        | _byte[]                 | BINARY        | geometry           |
| byte[]        | _byte[]                 | BINARY        | tinyblob           |
| byte[]        | _byte[]                 | BIT           | bit                |
| byte[]        | _byte[]                 | LONGVARBINARY | blob               |
| byte[]        | _byte[]                 | LONGVARBINARY | longblob           |
| byte[]        | _byte[]                 | LONGVARBINARY | mediumblob         |
| byte[]        | _byte[]                 | VARBINARY     | varbinary          |
| Boolean       | java.long.Boolean       | BIT           | bit                |
| Boolean       | java.long.Boolean       | BIT           | tinyint            |
| Blob          | java.sql.Blob           | BLOB          | blob*              |
| String        | java.lang.String        | CHAR          | char               |
| String        | java.lang.String        | CHAR          | enum               |
| String        | java.lang.String        | CHAR          | set                |
| String        | java.lang.String        | VARCHAR       | tinytext           |
| String        | java.lang.String        | VARCHAR       | varchar            |
| String        | java.lang.String        | LONGVARCHAR   | longtext           |
| String        | java.lang.String        | LONGVARCHAR   | mediumtext         |
| String        | java.lang.String        | LONGVARCHAR   | text               |
| Date          | java.util.Date          | DATE          | date               |
| Date          | java.util.Date          | DATE          | year               |
| Date          | java.util.Date          | TIME          | time               |
| Date          | java.util.Date          | TIMESTAMP     | datetime           |
| Date          | java.util.Date          | TIMESTAMP     | timestamp          |
| LocalDate     | java.time.LocalDate     | DATE          | date*              |
| LocalDateTime | java.time.LocalDateTime | TIMESTRMP     | datetime*          |
| LocalDateTime | java.time.LocalDateTime | TIMESTRMP     | timestamp*         |
| BigDecimal    | java.math.BigDecimal    | DECIMAL       | decimal*           |
| Double        | java.lang.Double        | DOUBLE        | double             |
| Float         | java.lang.Float         | REAL          | float              |
| Float         | java.lang.Double        | FLOAT         | float              |
| Object        | java.lang.Object        | OTHER         | geometrycollection |
| Object        | java.lang.Object        | OTHER         | linestring         |
| Object        | java.lang.Object        | OTHER         | multilinestring    |
| Object        | java.lang.Object        | OTHER         | multipoint         |
| Object        | java.lang.Object        | OTHER         | multipolygon       |
| Object        | java.lang.Object        | OTHER         | point              |
| Object        | java.lang.Object        | OTHER         | polygon            |
| Integer       | java.lang.Integer       | INTEGER       | int                |
| Integer       | java.lang.Integer       | INTEGER       | mediumint          |
| short         | java.lang.Short         | SMALLINT      | smallint           |
| Byte          | java.lang.Byte          | TINYINT       | tinyint            |

> 另：DB中的int类型不能配置unsigned，不然会放大int类型的取值范围


todo：如何自动化检测项目代码中不规范的映射？